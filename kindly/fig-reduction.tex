\begin{figure*}[ht]
  % \input{semantics}
  \begin{align*}
    \htag{Addresses}
    \alpha &::= \ell \tag{Locations}\\
           &\mid \borrow{\alpha} \tag{Borrowed Locations}
    \\
    \htag{Values}
    v &::= \alpha \mid c
  \end{align*}
  \begin{mathpar}
    \inferrule{}{ \Sigma, \rho \vdash c \Downarrow \Sigma, c}

    \inferrule{}{\Sigma, \rho \vdash x \Downarrow \Sigma, \rho(x)}

    \inferrule{
      \ell\notin\Dom\Sigma \\
      \Sigma' = \Sigma[\ell \mapsto (\rho. \closure{}{x}{e})]
    }{
      \Sigma, \rho \vdash \lam xe \Downarrow \Sigma', \ell
    }
    
    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', \ell \\
      \Sigma' (\ell) = (\rho'',\closure{}{x}{e''}) \\
      \Sigma', \rho \vdash e' \Downarrow \Sigma'', v' \\
      \Sigma'', \rho''[x\mapsto v'] \vdash e'' \Downarrow \Sigma''', v
    }{\Sigma, \rho \vdash \app{e}{e'} \Downarrow \Sigma''', v}

    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', v \\
      \Sigma', \rho[x \mapsto v] \vdash e' \Downarrow \Sigma'', v'
    }{
      \Sigma, \rho \vdash \letin{x}{e}{e'} \Downarrow \Sigma'', v'
    }

    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', v \\
      \Sigma', \rho \vdash e' \Downarrow \Sigma'', v' \\
      \ell\notin\Dom{\Sigma''} \\
      \Sigma''' = \Sigma''[\ell \mapsto (v, v')]
    }{
      \Sigma, \rho \vdash \introPair{e}{e'} \Downarrow \Sigma''', \ell
    }

    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', \ell \\
      \Sigma' (\ell) = (v, v') \\
      \Sigma', \rho[x,y \mapsto v, v'] \vdash e' \Downarrow \Sigma'', v''
    }{
      \Sigma, \rho \vdash \letin{x,y}{e}{e'} \Downarrow  \Sigma'', v''
    }

    \inferrule{
      \rho (x) = \alpha \\
      \Sigma (\alpha) = W \\
      (\Sigma\setminus\alpha)[\borrow{\alpha} \mapsto W], \rho \vdash e
      \Downarrow \Sigma', v \\
      \Sigma'' = (\Sigma' \setminus\borrow{\alpha})[\alpha \mapsto W]
    }{
      \Sigma, \rho \vdash \region{x}{e} \Downarrow \Sigma', v
    }

    \inferrule{\rho (x) = \alpha}{
      \Sigma, \rho \vdash \borrow{x} \Downarrow \Sigma, \borrow\alpha
    }
    \\
    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', v
      \ell\notin \Dom\Sigma' }{
      \Sigma,\rho \vdash \create e \Downarrow \Sigma'[\ell \mapsto \rss{v}], \ell
    }

    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', \ell \\
      \Sigma' (\ell) = \rss{v}
    }{
      \Sigma, \rho \vdash \destroy e \Downarrow \Sigma'\setminus\ell, ()
    }

    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', \borrow[i]\alpha \\
      \Sigma' (\borrow[i]\alpha) = \rss{v}
    }{
      \Sigma, \rho \vdash \observe e \Downarrow \Sigma', v
    }

    \inferrule{
      \Sigma, \rho \vdash e \Downarrow \Sigma', \borrow[m]\alpha \\
      \Sigma', \rho \vdash e' \Downarrow \Sigma'', v' \\
      \Sigma'' (\borrow[m]\alpha) = \rss{v} \\
      \Sigma''' = \Sigma''[\borrow[m]\alpha \mapsto v']
    }{
      \Sigma, \rho \vdash \update e {e'} \Downarrow \Sigma''', ()
    }

  \end{mathpar}
  \caption{Reduction rules -- $\Sigma, \rho, \vdash e \Downarrow
    \Sigma', v$ }
  \label{fig:reduction}
\end{figure*}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
